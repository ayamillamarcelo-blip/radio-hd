<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>CENTRAL ULTRA-LOW LATENCY</title>
    <style>
        body { background: #050505; color: #00ff00; font-family: monospace; text-align: center; padding: 40px; }
        .box { border: 2px solid #0f0; padding: 30px; border-radius: 15px; display: inline-block; background: #111; }
        #status { font-size: 24px; margin: 20px 0; color: #fff; }
        .vu { width: 300px; height: 10px; background: #222; margin: 5px auto; border-radius: 5px; overflow: hidden; }
        .bar { height: 100%; width: 0%; background: #0f0; transition: 0.05s; }
        button { background: #0f0; color: #000; padding: 15px 30px; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="box">
        <h2>üéôÔ∏è CENTRAL HD (2 V√çAS)</h2>
        <p>ID: <strong>RADIO-PRUEBA-123</strong></p>
        <button id="startBtn" onclick="iniciarCentral()">1. ACTIVAR MIC Y CONECTAR</button>
        <div id="status">DESCONECTADO</div>
        
        <div class="vu"><div id="v-l" class="bar"></div></div>
        <div class="vu"><div id="v-r" class="bar"></div></div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.5.2/peerjs.min.js"></script>
<script>
    let localStream;
    let audioCtx;
    const peer = new Peer('RADIO-PRUEBA-123', {
        config: { 'iceServers': [{ 'urls': 'stun:stun.l.google.com:19302' }] }
    });

    async function iniciarCentral() {
        // Captura pura sin procesamiento (baja latencia)
        localStream = await navigator.mediaDevices.getUserMedia({ 
            audio: { echoCancellation: false, noiseSuppression: false, autoGainControl: false, latency: 0 } 
        });
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('status').innerText = "üü¢ ESPERANDO CELULAR...";
    }

    peer.on('call', call => {
        call.answer(localStream);
        call.on('stream', remoteStream => {
            document.getElementById('status').innerText = "üî¥ EN AIRE";
            reproducirHD(remoteStream);
        });
    });

    function reproducirHD(stream) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)({ latencyHint: 'interactive' });
        const source = audioCtx.createMediaStreamSource(stream);
        
        // V√∫metro
        const analyzer = audioCtx.createAnalyser();
        source.connect(analyzer);
        const data = new Uint8Array(analyzer.frequencyBinCount);
        
        // Salida directa a parlantes
        source.connect(audioCtx.destination);

        const draw = () => {
            analyzer.getByteFrequencyData(data);
            let vol = data.reduce((a,b)=>a+b,0)/data.length;
            document.getElementById('v-l').style.width = (vol*3) + "%";
            document.getElementById('v-r').style.width = (vol*3) + "%";
            requestAnimationFrame(draw);
        }
        draw();
    }
</script>
</body>
</html>
