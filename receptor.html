<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>üéß CENTRAL DE RECEPCI√ìN HD</title>
    <style>
        body { background:#0a0a0a; color:#00ff00; font-family:monospace; padding:40px; text-align:center; }
        .monitor { background:#111; border:2px solid #00ff00; border-radius:15px; padding:30px; display:inline-block; min-width: 320px; }
        #id-display { font-size:20px; background:#000; padding:15px; margin:20px 0; border:1px dashed #00ff00; color: #fff; word-break: break-all; }
        .status-ready { color: #00ff00; font-weight: bold; }
        .status-error { color: #ff0000; font-weight: bold; }
    </style>
</head>
<body>
    <div class="monitor">
        <h2>üìª CENTRAL DE RADIO</h2>
        <div id="id-display">ESPERANDO AL SERVIDOR...</div>
        <div id="info">Iniciando sistema...</div>
        
        <div style="margin-top:20px; text-align: left;">
            <p>1. Copia el ID de arriba.</p>
            <p>2. P√©galo en el Celular (Emisor).</p>
            <p>3. Dale a Transmitir.</p>
        </div>
    </div>

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    
    <script>
        const idDisplay = document.getElementById('id-display');
        const info = document.getElementById('info');

        // Configuraci√≥n con servidores para saltar bloqueos
        const peer = new Peer({
            config: {
                iceServers: [
                    { urls: "stun:stun1.l.google.com:19302" },
                    { urls: "turn:openrelay.metered.ca:443", username: "openrelayproject", password: "openrelayproject" }
                ]
            }
        });

        // Evento cuando el servidor nos asigna un ID
        peer.on('open', (id) => {
            console.log('ID recibido:', id);
            idDisplay.innerText = id;
            info.innerHTML = '<span class="status-ready">üü¢ SISTEMA LISTO</span>';
        });

        // Evento por si hay error de conexi√≥n al servidor
        peer.on('error', (err) => {
            console.error(err);
            idDisplay.innerText = "ERROR DE RED";
            info.innerHTML = `<span class="status-error">‚ùå ${err.type}</span>`;
        });

        // Evento cuando entra una llamada
        peer.on('call', (call) => {
            info.innerText = "üì° RECIBIENDO SE√ëAL...";
            call.answer(); // Contestamos
            
            call.on('stream', (remoteStream) => {
                const audio = new Audio();
                audio.srcObject = remoteStream;
                audio.play().catch(e => {
                    info.innerHTML = '<button onclick="location.reload()">Haga clic aqu√≠ para habilitar audio</button>';
                });
                info.innerText = "üîä EN VIVO";
            });
        });
    </script>
</body>
</html>

