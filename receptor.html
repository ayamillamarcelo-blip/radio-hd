<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>üéôÔ∏è CENTRAL STEREO HD</title>
    <style>
        body { background: #0a0a0a; color: #00ff00; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .monitor { background: #111; border: 2px solid #333; border-radius: 15px; padding: 25px; width: 450px; box-shadow: 0 0 30px rgba(0,0,0,0.5); border-top: 4px solid #00ff00; }
        #id-display { font-size: 22px; background: #000; padding: 15px; margin: 15px 0; border: 1px dashed #444; color: #fff; text-align: center; border-radius: 8px; }
        
        /* Estilos del V√∫metro de 2 v√≠as */
        .vu-label { font-size: 10px; color: #888; margin-bottom: 5px; }
        .vu-container { height: 20px; background: #000; border-radius: 3px; margin: 5px 0 15px 0; position: relative; overflow: hidden; border: 1px solid #222; }
        .vu-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #00ff00 60%, #ffff00 80%, #ff0000 100%); transition: width 0.05s; }
        
        .status { font-size: 14px; margin-bottom: 20px; text-align: center; color: #aaa; }
        button { background: #00ff00; color: #000; border: none; padding: 15px; font-weight: bold; cursor: pointer; width: 100%; border-radius: 5px; font-size: 16px; }
        button:active { transform: scale(0.98); }
        #log { font-size: 10px; color: #444; margin-top: 15px; height: 40px; overflow: hidden; }
    </style>
</head>
<body>
    <div class="monitor">
        <h2 style="margin:0; text-align: center;">üìª CENTRAL DE RECEPCI√ìN</h2>
        
        <div id="id-display">CONECTANDO...</div>
        <div class="status" id="info">Esperando conexi√≥n de PeerJS...</div>
        
        <div class="vu-label">CANAL IZQUIERDO (L)</div>
        <div class="vu-container"><div id="vu-l" class="vu-bar"></div></div>
        
        <div class="vu-label">CANAL DERECHO (R)</div>
        <div class="vu-container"><div id="vu-r" class="vu-bar"></div></div>

        <button id="btn-audio" onclick="iniciarAudio()">üîì ACTIVAR MONITOR</button>
        
        <div id="log">Iniciando sistema...</div>
    </div>

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script>
        let audioCtx;
        const info = document.getElementById('info');
        const log = (t) => document.getElementById('log').innerText = t;

        // 1. Configurar PeerJS
        const peer = new Peer();

        peer.on('open', id => {
            document.getElementById('id-display').innerText = id;
            info.innerText = "üü¢ LISTO PARA RECIBIR";
            log("Conectado al servidor de se√±alizaci√≥n.");
        });

        // 2. Funci√≥n para desbloquear el audio (Click obligatorio)
        function iniciarAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            document.getElementById('btn-audio').style.background = "#222";
            document.getElementById('btn-audio').style.color = "#00ff00";
            document.getElementById('btn-audio').innerText = "üîä MONITOREO ACTIVO";
            log("Audio Context activado.");
        }

        // 3. Recibir la llamada
        peer.on('call', call => {
            log("Llamada entrante detectada...");
            call.answer(); 

            call.on('stream', remoteStream => {
                info.innerText = "üî¥ EN EL AIRE";
                info.style.color = "#ff0000";
                
                // Reproducci√≥n
                const audio = new Audio();
                audio.srcObject = remoteStream;
                audio.play().catch(e => log("Error: Haz clic en el bot√≥n verde primero."));

                // L√≥gica del V√∫metro Est√©reo (2 v√≠as)
                if(!audioCtx) audioCtx = new AudioContext();
                const source = audioCtx.createMediaStreamSource(remoteStream);
                
                // Separador de canales
                const splitter = audioCtx.createChannel


