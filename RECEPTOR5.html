<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Receptor HD 44.1</title>
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<style>
body{background:#000;color:white;font-family:Arial;text-align:center}
#vu{width:300px;height:20px;background:#333;margin:20px auto}
#bar{height:100%;width:0%;background:red}
</style>
</head>
<body>

<h2>ðŸ“» RECEPTOR HD 44.1</h2>
<div id="vu"><div id="bar"></div></div>
<audio id="audio" autoplay playsinline></audio>

<script>
let audioContext;
let analyser;
let dataArray;

const peer = new Peer("fm_receptor_44100");

peer.on("call", call=>{
    call.answer();
    call.on("stream", stream=>{
        const audio = document.getElementById("audio");
        audio.srcObject = stream;
        audio.play();

        audioContext = new AudioContext({sampleRate:44100});
        const source = audioContext.createMediaStreamSource(stream);
        analyser = audioContext.createAnalyser();
        analyser.fftSize = 256;
        source.connect(analyser);
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        vu();
    });
});

function vu(){
    analyser.getByteFrequencyData(dataArray);
    let sum = dataArray.reduce((a,b)=>a+b,0);
    let avg = sum/dataArray.length;
    document.getElementById("bar").style.width = avg+"%";
    requestAnimationFrame(vu);
}
</script>

</body>
</html>


