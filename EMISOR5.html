<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Emisor HD 44.1</title>
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<style>
body{background:#111;color:white;font-family:Arial;text-align:center}
button{padding:15px 30px;font-size:18px;margin-top:20px}
#vu{width:300px;height:20px;background:#333;margin:20px auto}
#bar{height:100%;width:0%;background:lime}
</style>
</head>
<body>

<h2>ðŸŽ™ EMISOR HD 44.1</h2>
<div id="vu"><div id="bar"></div></div>
<button onclick="iniciar()">Transmitir</button>

<script>
let localStream;
let audioContext;
let analyser;
let dataArray;

const peer = new Peer("fm_emisor_44100");

navigator.mediaDevices.getUserMedia({
    audio: {
        sampleRate: 44100,
        channelCount: 2,
        echoCancellation: false,
        noiseSuppression: false,
        autoGainControl: false
    }
}).then(stream=>{
    localStream = stream;

    audioContext = new AudioContext({sampleRate:44100});
    const source = audioContext.createMediaStreamSource(stream);
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 256;
    source.connect(analyser);
    dataArray = new Uint8Array(analyser.frequencyBinCount);
    vu();
});

function vu(){
    analyser.getByteFrequencyData(dataArray);
    let sum = dataArray.reduce((a,b)=>a+b,0);
    let avg = sum/dataArray.length;
    document.getElementById("bar").style.width = avg+"%";
    requestAnimationFrame(vu);
}

function iniciar(){
    peer.call("fm_receptor_44100", localStream);
}
</script>

</body>
</html>

